<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>图片懒加载2</title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}

			.wrapper {
				margin: 100px auto 0;
				width: 1000px;
			}

			.wrapper h2 {
				height: 50px;
				line-height: 50px;
				background: #ccc;
				text-align: center;
			}

			.wrapper ul {
				list-style: none;
				padding: 10px 0;
				overflow: hidden;
			}

			.wrapper li {
				float: left;
				width: 199px;
				height: 240px;
				text-align: center;
				background: url("images/empt.gif") no-repeat center;
			}
			.wrapper .box {
				height: 550px;
				border: 1px solid #ccc;
				margin: 10px 0;
			}
			.wrapper li img {
				/* animation: fadein 1s ease; */
			}
			@keyframes fadein {
				0{
					opacity: 0;
				}
				50% {
					opacity: 0.5;
				}
				100% {
					opacity: 1;
				}
			}
			.wrapper li a {
				display: block;
			}
		</style>
	</head>

	<body>

		<div class="wrapper">
			<h2>图片延迟加载</h2>
			<div class="box">
			</div>
			<ul>
				<li>
					<img data-src="images/v1.jpg" alt="" />
					<a href="">电影1</a>
				</li>
				<li>
					<img data-src="images/v2.jpg" alt="" />
					<a href="">电影2</a>
				</li>
				<li>
					<img data-src="images/v3.jpg" alt="" />
					<a href="">电影3</a>
				</li>
				<li>
					<img data-src="images/v4.jpg" alt="" />
					<a href="">电影4</a>
				</li>
				<li>
					<img data-src="images/v5.jpg" alt="" />
					<a href="">电影5</a>
				</li>
			</ul>

			<div class="box">

			</div>
			<ul>
				<li>
					<img data-src="images/v6.jpg" alt="" />
					<a href="">电影6</a>
				</li>
				<li>
					<img data-src="images/v7.jpg" alt="" />
					<a href="">电影7</a>
				</li>
				<li>
					<img data-src="images/v8.jpg" alt="" />
					<a href="">电影8</a>
				</li>
				<li>
					<img data-src="images/v9.jpg" alt="" />
					<a href="">电影9</a>
				</li>
				<li>
					<img data-src="images/v10.jpg" alt="" />
					<a href="">电影10</a>
				</li>
			</ul>

			<div class="box">

			</div>
			<ul>
				<li>
					<img data-src="images/v11.jpg" alt="" />
					<a href="">电影11</a>
				</li>
				<li>
					<img data-src="images/v12.jpg" alt="" />
					<a href="">电影12</a>
				</li>
				<li>
					<img data-src="images/v13.jpg" alt="" />
					<a href="">电影13</a>
				</li>
				<li>
					<img data-src="images/v14.jpg" alt="" />
					<a href="">电影14</a>
				</li>
				<li>
					<img data-src="images/v15.jpg" alt="" />
					<a href="">电影15</a>
				</li>
			</ul>
			<div class="box">

			</div>
		</div>
		<script type="text/javascript">
			window.onload = function() {
				var img = document.getElementsByTagName("img");
				console.log(img[0].getAttribute("data-src")) // images/v1.jpg
				/*img[0].setAttribute('id', "src")
				 * element.setAttribute(name, value);
					name 是表示属性名称的字符串
					value 是属性的新值
				 */
				// 获取滚动条的高度
				document.addEventListener("scroll", fangdou(function() {
					// 滚动条
					var scrollTop = document.body.scrollTop || document.documentElement.scrollTop
					// 获取视口的高度，是不变的。
					var ch = document.documentElement.clientHeight;
					for(var i = 0; i < img.length; i++) {
						var img_h = img[i].offsetTop;
						console.log(ch)
						console.log(scrollTop)
						console.log(img_h)
						if(ch + scrollTop >= img_h + 50) {
							// getAttribute() 返回元素上一个指定的属性值。如果指定的属性不存在，则返回  null 或 ""（空字符串）
							img[i].src = img[i].getAttribute("data-src");
							img[i].style.animation = "fadein 1s ease";
						}
					}

				}, 100))
				// 防抖，降低性能消耗
				function fangdou(callback, delay) {
					// 定时器
					var timer;
					return function() {
						if(timer) { // 引用外部函数的timer
							clearTimeout(timer)
						}
						timer = setTimeout(() => {
							callback.apply(this, arguments)
						}, delay)
					}
				}
			}
		</script>
	</body>

</html>
